<!DOCTYPE html>
<html lang="en">
  <head>
    <base href="../">
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no" />
    <title>Sodium</title>
    <meta name="description" content="Sodium is a site used for evading internet censorship" />
    <meta name="keywords" content="Sodium, z1g-project, internet-censorship, evade-internet-censorship">
    <meta property="og:image" content="/sodium.png">
    <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#27639f" />
    <meta name="googlebot" content="all" />
    <link id="favicon" rel="icon" type="image/png" href="favicon.ico">
    <link rel="stylesheet" href="assets/css/montserrat.css"/>
    <link rel="stylesheet" href="assets/css/item-cards.css"/>
    <link rel="stylesheet" href="assets/css/ui.css" id="custom-css"/>
    <script src="https://cdn.jsdelivr.net/npm/libcurl.js@latest/libcurl_full.js" defer></script>
    <script src="ultra/ultra.bundle.js" defer></script>
    <script src="ultra/ultra.config.js" defer></script>
    <script src="assets/js/register-sw.js" defer></script>
    <script src="assets/js/search.js" defer></script>
    <link rel="json" href="assets/json/appx.json" defer></script>
    <link rel="manifest" href="manifest.webmanifest"/>
    <script src="assets/js/time.js" defer></script>
    <script src="assets/js/settings.js" defer></script>
    <script src="assets/js/fade.js" defer></script>
    <script src="assets/js/apps.js" defer></script>
    <script src="regcache.js" defer></script>
    <script>
    document.addEventListener("libcurl_load", async () => {
      if (window.location.origin.includes('.pages.dev')) {
        const wispSrv = `wss://tomp.app/wisp/`
        libcurl.set_websocket(`${wispSrv}`)
      } else {
        const wispSrv = `${window.location.protocol.replace("http", "ws")}//${window.location.host}/wisp/`
        libcurl.set_websocket(`${wispSrv}`)
      }
      const appsContainer = document.getElementById("apps-container");
      try {
      const { data: apps } = await libcurl.fetch("https://z1g-backend.vercel.app/api/apps").then((req) => req.json()).catch((err) => {
        console.error(err)
        return null;
      });
      if (!apps) {
        appsContainer.innerHTML = "<p>Failed to load apps</p>";
        return;
      }
      apps.forEach(async (app) => {
        const column = document.createElement("div");
        column.classList.add("column");
        const a = document.createElement("a");
        a.onclick = () => loadapp(app.url);
        const img = document.createElement("img");
        const image = await libcurl.fetch(app.icon).then((req) => req.blob()).then((blob) => URL.createObjectURL(blob));
        img.src = image;
        img.width = 150;
        img.height = 75;
        const p = document.createElement("p");
        p.textContent = app.name;
        a.appendChild(img);
        a.appendChild(p);
        column.appendChild(a);
        appsContainer.appendChild(column);
      });
      } catch (err) {
        console.error(err);
        appsContainer.innerHTML = "<p>Failed to load apps</p>";
      }
    });
      function loadapp(value) {
        let url = value.trim();

        const proxyOption = localStorage.getItem("proxyOption");

        if (proxyOption && proxyOption.toLowerCase() === "dynamic") {
          const dynamicURL = `${window.location.origin}/service/${Ultraviolet.codec.xor.encode(url)}`;
          sessionStorage.setItem("appUrl", dynamicURL);
        } else {
          if (!checkUrl(url)) {
            url = "https://www.google.com/search?q=" + url;
          } else if (!(url.startsWith("https://") || url.startsWith("http://"))) {
            url = "https://" + url;
          }

          sessionStorage.removeItem("appUrl");

          const encodedUrl = `${window.location.origin}/sw/${Ultraviolet.codec.xor.encode(url)}`;
          sessionStorage.setItem("appUrl", encodedUrl);
        }

        location.href = "appframe.html";
      };

      function checkUrl(val = "") {
        if (/^http(s?):\/\//.test(val) || (val.includes(".") && val.substr(0, 1) !== " ")) {
          return true;
        }
       return false;
      }

      if (navigator.onLine) {
        navigator.serviceWorker.register('acache.js')
        .then((registration) => {
          console.log('Game/Asset Cache Service Worker registered with scope:', registration.scope);
        })
        .catch((error) => {
          console.error('Error registering Service Worker:', error);
        });
      } else {
        console.warn('Your Offline: Using existing Cache')
      }
  </script>
  </head>

  <body>
    <div class="second-bar">
      <a href="/" title="Home" class="second-bar-link home-link"></a>
      <a href="/games/" title="Games" class="second-bar-link games-link"></a>
      <a href="/apps/" title="Apps" class="second-bar-link apps-link"></a>
      <a href="/settings/" title="Settings" class="second-bar-link settings-link"></a>
      <div class="info-menu" id="info-menu" style="margin-left: auto">
        <div class="info-menu-item" id="transferRate"></div>
        <div class="info-menu-item" id="latency"></div>
        <div class="info-menu-item" id="fps"></div>
      </div>
      <div class="top-bar-item" id="time"></div>
      <div class="top-bar-item">
        <div class="battery-icon-container">
          <div id="battery" class="battery-icon"></div>
          <div class="battery-fill"></div>
          <p class="battery-text"></p>
        </div>
      </div>
    </div>

    <h1 style="text-align: center;">Apps</h1>
    <h3 style="text-align: center;">Official Apps that are working and ready for use!</h3>

    <div class="input-container">
        <input class="config-input" type="text" id="gamesearch" onkeyup="searchgames()" placeholder="Search" style="text-align: center;font-size: 16px;">
    </div>

    <div class="container-apps" id="apps-container">
    </div>
    <br>
    <br>
    <br>
    <div id="footer" class="fullwidth">
      <div class="footerflex">
          <div class="footerbrand">
              <h3><a href="/">Sodium</a></h3>
              <p>Evading Internet Censorship for over 6 Months!</p>
          </div>
          <div class="footerlist">
            <p style="margin-top: 58px;">Sodium Â© z1g Project 2024</hp>
          </div>
      </div>
      <div class="footersocials">
        <img src="assets/img/z1g.png" alt="z1g Project" title="The z1g Project GitHub organization" height="30" width="30" onclick="location.href='/github/z1g-project/'">
        <img src="assets/img/discord.jpg" alt="Discord" title="The z1g Project Discord" height="30" width="30" onclick="location.href='/discord/'">
        <img src="assets/img/github.png" alt="GitHub" title="The official deployment repository for Sodium" height="30" width="30" onclick="location.href='/github/'">
        <img src="assets/img/license.svg" alt="Credits" title="License information" height="30" width="30" onclick="location.href='/credits/'">
      </div>
    </div>
  </body>
</html>
